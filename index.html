<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- styles -->
    <link type="text/css" href="/css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" href="/css/style.css" rel="stylesheet">
    <!-- js links -->
    <script type="text/javascript" src="/js/materialize.min.js"></script>
    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>
    <title>Fish Pond</title>
    <!-- link to manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#FFE1C4">
</head>

<body>
    <header></header>
    <div class="footer indigo">
        <div class="container">
            <div class="row">
                <ul class="center">
                    <li><a class="grey-text text-lighten-3 col s4" href="#!">Pond</a></li>
                    <li><a class="grey-text text-lighten-3 col s4" href="#!">Fish</a></li>
                    <li><a class="grey-text text-lighten-3 col s4" href="#!">Profile</a></li>
                </ul>
            </div>
        </div>
    </div>
    <main>

        <div class="container">
            <div id="welcome-location">Welcome</div>

            <div class="fish container">
            </div>
        </div>
    </main>



    <!-- DB Link -->

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.9.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.9.3/firebase-firestore.js"></script>
    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyDWZIlMrHn0gXM8K4IhthYxXw8tyB3ks48",
            authDomain: "fishpond-pwa.firebaseapp.com",
            databaseURL: "https://fishpond-pwa.firebaseio.com",
            projectId: "fishpond-pwa",
            storageBucket: "fishpond-pwa.appspot.com",
            messagingSenderId: "986686776620",
            appId: "1:986686776620:web:69dbf122ef36afb28cb889",
            measurementId: "G-Q2TLGC8KV4"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <script src="/js/app.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/db.js"></script>
</body>

</html>
<script>

    $(document).ready(() => {
        if (sessionStorage.getItem("logged_in")) {
        } else {
            window.location.href = "./pages/signup_login.html";
        }
        getGeo(function (res) {
            console.log("Your position:");
            console.log("Latitude:", res.latitude);
            console.log("Longitude:", res.longitude);
            getCity(res.latitude, res.longitude, function (city) {
                console.log("city:", city);
                $("#welcome-location").html(`Welcome to the ${city} pond`);
                getFish(city);
            })
        })
    });

    function getGeo(callback) {
        //ops
        var options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0
        };
        //done
        function success(pos) {
            callback(pos.coords);
        }
        //err handle
        function error(err) {
            console.warn(`ERROR(${err.code}): ${err.message}`);
        }
        //call
        navigator.geolocation.getCurrentPosition(success, error, options);
    }

    //reverse geocoding from lat and long
    function getCity(lat, long, callback) {
        var token = "access_token=pk.eyJ1IjoibWF0dGZpY2tlIiwiYSI6ImNqNnM2YmFoNzAwcTMzM214NTB1NHdwbnoifQ.Or19S7KmYPHW8YjRz82v6g&cachebuster=1582041948131&autocomplete=true";
        var url = "https://api.mapbox.com/geocoding/v5/mapbox.places/" + long + "%2C" + lat + ".json?" + token;

        $.get(url, function (data, status) {
            callback(data.features[2].text);
        })
    }
</script>