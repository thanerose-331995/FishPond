<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- styles -->
    <link type="text/css" href="../css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" href="../css/style.css" rel="stylesheet">
    <!-- js links -->
    <script type="text/javascript" src="../js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../js/materialize.min.js"></script>
    <title>Fish Pond</title>
    <!-- link to manifest -->
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#FFE1C4">
</head>

<body>
    <div class="page-content">
        <!-- HEADER -->
        <div class="head container">
            <ul id="top-bar">
                <li>
                    <h5 class="grey-text text-lighten-4"><b>FishPond</b></h5>
                </li>
                <li>
                    <div id="logout">
                        <i class="btn-flat material-icons grey-text text-lighten-4">exit_to_app</i>
                    </div>
                </li>
            </ul>
        </div>
        <!-- CONTENT -->
        <div class="content container">
            <div id="profile-data" class="container center"></div>
            <h6 class="center white-text">User Fish</h6>
            <div id="user-fish" class="container"></div>
        </div>
        <div id="edit-profile" class="modal">
            <div class="modal-content center">
                <h6><b>Edit Profile</b></h6>
                <br>
                <form class="row">
                    <div class="divider"></div>
                    <br>
                    <div id="edit-pfp" class="responsive-img circle"
                        style="height: 100px; width: 100px;background-color: aquamarine;margin: auto;"></div>
                    <input id="pfp-upload" onchange="pfpUpdate()" type="file" name="file">
                    <br>
                    <div class="input-field col s6">
                        <input placeholder="Placeholder" id="first_name" type="text" class="validate">
                        <label for="first_name">First Name</label>
                    </div>
                    <div class="input-field col s6">
                        <input placeholder="Placeholder" id="first_name" type="text" class="validate">
                        <label for="last">Last Name</label>
                    </div>
                    <div class="input-field col s12">
                        <input placeholder="Placeholder" id="username" type="text" class="validate">
                        <label for="username">Username</label>
                    </div>
                </form>
                <a href="#!" class="modal-close waves-effect waves-cyan btn-flat">Save</a>
            </div>
        </div>
        <!-- FOOTER -->
        <div class="end z-depth-0">
            <div class="container">
                <div class="row">
                    <ul class="center">
                        <li class="col s3">
                            <a href="./main.html" class="btn-floating cyan waves-effect"><i
                                    class="material-icons">home</i></a>
                        </li>
                        <li class="col s3">
                            <a href="./feed.html" class="btn-floating cyan waves-effect"><i
                                    class="material-icons">home</i></a>
                        </li>
                        <li class="col s3">
                            <a class="btn-floating disabled cyan waves-effect"><i
                                    class="material-icons">chat_bubble</i></a>
                        </li>
                        <li class="col s3">
                            <a href="./profile.html" class="btn-floating disabled cyan waves-effect"><i
                                    class="material-icons">account_circle</i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.9.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.9.3/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-auth.js"></script>

    <script src="../js/app.js"></script>
    <script src="../js/db.js"></script>
    <!-- <script src="../js/ui.js"></script> -->
    <script src="../js/fish.js"></script>
</body>
<script>

    $(document).ready(() => {
        $('.modal').modal();

        var user = $.parseJSON(sessionStorage.user);
        db.collection('users').doc(user.uid).get().then(snapshot => {
            var name = snapshot.data().first_name + " " + snapshot.data().last_name;
            for (var x = 0; x < name.length; x++) {
                name = name.replace(name[x], name[x].toUpperCase());
            }
            const html = `
                <div id="profile-img">
                    <div id="overlay" class="center white-text"><i class="material-icons medium" style="margin-top: 20%" onClick="openEdit()">edit</i></div>
                    <img src="../img/fish.png" class="responsive-img circle z-depth-1">
                </div>
                <p><b>${name}</b></p>
                <h4><i>${snapshot.data().username}</i></h4>
            `;
            getFish("parent", snapshot.data().username);
            $("#profile-data").append(html);
        })
    });

    function openEdit() {
        var modal = M.Modal.getInstance($("#edit-profile"));
        modal.open();
    }

    function pfpUpdate() {
        var form = $("#edit-profile form");
        console.log(form);
        const user = JSON.parse(sessionStorage.user);
        upload(form[0].file.files[0], 'temp/' + user.uid, () => {
            download('temp/' + user.uid, url => {
                $("#edit-pfp").attr("src", url);
                $("#edit-pfp").css("background-size", "cover");
            })
        })
        // if (type == "edit") {
        //     var form = $("#edit-pet");
        //     var output = $("#edit-pet-pfp");
        // }
        // else {
        //     var form = $("#add-pet");
        //     var output = $("#new-pet-pfp");
        // }
        // const user = JSON.parse(sessionStorage.getItem("user"));
        // upload(form[0].file.files[0], 'temp/' + user.uid, () => {
        //     download('temp/' + user.uid, url => {
        //         output.attr("src", url);
        //         output.css("background-size", "cover");
        //     })
        // })
    }

</script>

</html>